import {Component, OnInit} from '@angular/core';
import {ActivatedRoute} from "@angular/router";
import {HttpClient} from "@angular/common/http";

@Component({
  selector: 'app-jira-app',
  templateUrl: './jira-app.component.html',
  styleUrls: ['./jira-app.component.scss']
})
export class JiraAppComponent implements OnInit {

  appId: any;
  appName: any;
  app: any;
  fullStars: any;
  halfStars: any;

  constructor(private route: ActivatedRoute, private http: HttpClient) {
  }

  async ngOnInit() {
    this.route.params.subscribe(
      async params => {
        this.appId = params['appId'];
        this.appName = params['appName'];
        // const response = await this.http.post('https://marketplace.atlassian.com/gateway/api/graphql',
        //   `{"operationName":"GetMarketplaceAppListingById","variables":{"appId":"1224236","location":"WEBSITE","visibility":null},"query":"query GetMarketplaceAppListingById($appId: ID!, $location: MarketplaceLocation, $visibility: MarketplaceAppVersionVisibility) {  marketplaceApp(appId: $appId) {    ...AppListingApp    ...PublicPrivateAppVersions    ...AllServerDCAppVersionsCount    productHostingOptions(excludeHiddenIn: $location)    cloudAppVersions: versions(      filter: {productHostingOptions: [CLOUD], excludeHiddenIn: $location, visibility: $visibility}      first: 1    ) {      ...AppListingAppVersionConnection      __typename    }    serverAppVersions: versions(      filter: {productHostingOptions: [SERVER], excludeHiddenIn: $location, visibility: $visibility}      first: 1    ) {      ...AppListingAppVersionConnection      __typename    }    dataCenterAppVersions: versions(      filter: {productHostingOptions: [DATA_CENTER], excludeHiddenIn: $location, visibility: $visibility}      first: 1    ) {      ...AppListingAppVersionConnection      __typename    }    __typename  }}fragment AppListingApp on MarketplaceApp {  name  appKey  appId  entityStatus  slug  tagline  privacyPolicyUrl  listingStatus  createdAt  marketingLabels  googleAnalyticsId  summary  jsdWidgetKey  categories {    ...AppListingCategory    __typename  }  wikiUrl  forumsUrl  isAtlassianCommunityEnabled  issueTrackerUrl  supportTicketSystemUrl  statusPageUrl  watchersInfo {    ...AppListingWatcherStatus    __typename  }  logo {    ...AppListingImage    __typename  }  partner {    ...AppListingPartner    __typename  }  reviewSummary {    ...AppListingReviewSummary    __typename  }  distribution {    ...AppListingDistribution    __typename  }  programs {    ...AppListingProgram    __typename  }  __typename}fragment PublicPrivateAppVersions on MarketplaceApp {  ...PublicPrivateCloudVersions  ...PublicPrivateServerVersions  ...PublicPrivateDataCenterVersions  __typename}fragment AllServerDCAppVersionsCount on MarketplaceApp {  allServerDCAppVersions: versions(    filter: {visibility: PUBLIC, productHostingOptions: [SERVER, DATA_CENTER]}  ) {    totalCount    __typename  }  __typename}fragment AppListingAppVersionConnection on MarketplaceAppVersionConnection {  totalCount  edges {    node {      ...AppListingAppVersion      __typename    }    __typename  }  __typename}fragment AppListingCategory on MarketplaceAppCategory {  name  __typename}fragment AppListingWatcherStatus on MarketplaceAppWatchersInfo {  isUserWatchingApp  watchersCount  __typename}fragment AppListingImage on MarketplaceListingImage {  original {    id    width    height    __typename  }  highResolution {    id    width    height    __typename  }  __typename}fragment AppListingPartner on MarketplacePartner {  name  id  slug  partnerType  programs {    isCloudAppSecuritySelfAssessmentDone    __typename  }  partnerTier {    type    updatedDate    __typename  }  support {    contactDetails {      websiteUrl      ...AppListingPartnerSupportContact      __typename    }    availability {      ...AppListingPartnerSupportAvailability      __typename    }    __typename  }  __typename}fragment AppListingReviewSummary on MarketplaceAppReviewSummary {  rating  count  __typename}fragment AppListingDistribution on MarketplaceAppDistribution {  downloadCount  installationCount  isPreinstalledInServerDC  isPreinstalledInCloud  __typename}fragment AppListingProgram on MarketplaceAppPrograms {  cloudFortified {    status    programStatus    __typename  }  bugBountyParticipant {    cloud {      status      __typename    }    server {      status      __typename    }    dataCenter {      status      __typename    }    __typename  }  __typename}fragment PublicPrivateCloudVersions on MarketplaceApp {  publicCloudVersion: versions(    first: 1    filter: {productHostingOptions: [CLOUD], visibility: PUBLIC}  ) {    ...VersionBuildNumber    __typename  }  privateCloudVersion: versions(    first: 1    filter: {productHostingOptions: [CLOUD], visibility: PRIVATE}  ) {    ...VersionBuildNumber    __typename  }  __typename}fragment PublicPrivateServerVersions on MarketplaceApp {  publicServerVersion: versions(    first: 1    filter: {productHostingOptions: [SERVER], visibility: PUBLIC}  ) {    ...VersionBuildNumber    __typename  }  privateServerVersion: versions(    first: 1    filter: {productHostingOptions: [SERVER], visibility: PRIVATE}  ) {    ...VersionBuildNumber    __typename  }  __typename}fragment PublicPrivateDataCenterVersions on MarketplaceApp {  publicDataCenterVersion: versions(    first: 1    filter: {productHostingOptions: [DATA_CENTER], visibility: PUBLIC}  ) {    ...VersionBuildNumber    __typename  }  privateDataCenterVersion: versions(    first: 1    filter: {productHostingOptions: [DATA_CENTER], visibility: PRIVATE}  ) {    ...VersionBuildNumber    __typename  }  __typename}fragment AppListingAppVersion on MarketplaceAppVersion {  ...AppListingAllAppVersion  ...AppListingHostingSelectorAppVersion  __typename}fragment AppListingPartnerSupportContact on MarketplacePartnerSupportContact {  emailId  phoneNumber  websiteUrl  __typename}fragment AppListingPartnerSupportAvailability on MarketplacePartnerSupportAvailability {  daysOfWeek  isAvailable24Hours  startTime  endTime  timezone  timezoneOffset  holidays {    ...AppListingPartnerSupportHolidays    __typename  }  __typename}fragment VersionBuildNumber on MarketplaceAppVersionConnection {  edges {    node {      buildNumber      __typename    }    __typename  }  __typename}fragment AppListingAllAppVersion on MarketplaceAppVersion {  buildNumber  youtubeId  moreDetails  paymentModel  learnMoreUrl  endUserLicenseAgreementUrl  documentationUrl  purchaseUrl  isSupported  documentationUrl  releaseDate  releaseNotes  releaseSummary  releaseNotesUrl  version  heroImage {    ...AppListingImage    __typename  }  highlights {    ...AppListingHighlight    __typename  }  screenshots {    ...AppListingScreenshot    __typename  }  deployment {    ...AppListingAppDeployment    __typename  }  __typename}fragment AppListingHostingSelectorAppVersion on MarketplaceAppVersion {  buildNumber  paymentModel  purchaseUrl  learnMoreUrl  deployment {    ...AppListingAppDeployment    __typename  }  __typename}fragment AppListingPartnerSupportHolidays on MarketplacePartnerSupportHoliday {  holidayFrequency  date  __typename}fragment AppListingHighlight on MarketplaceListingHighlight {  title  caption  summary  croppedScreenshot {    ...AppListingImage    __typename  }  screenshot {    image {      ...AppListingImage      __typename    }    caption    __typename  }  __typename}fragment AppListingScreenshot on MarketplaceListingScreenshot {  caption  image {    ...AppListingImage    __typename  }  __typename}fragment AppListingAppDeployment on MarketplaceAppDeployment {  __typename  compatibleProducts {    ...AppListingCompatibleProduct    __typename  }  ... on MarketplaceInstructionalAppDeployment {    instructions {      instruction      screenshot {        ...AppListingImage        __typename      }      __typename    }    isBinaryUrlAvailable    __typename  }  ... on MarketplaceWorkflowAppDeployment {    isWorkflowDataFileAvailable    __typename  }  ...ConnectAppScopes  ...EcosystemCloudAppDetails}fragment AppListingCompatibleProduct on CompatibleAtlassianProduct {  id  name  __typename  atlassianProduct {    name    hostingOptions    __typename  }  ... on CompatibleAtlassianServerProduct {    minimumVersion    maximumVersion    __typename  }  ... on CompatibleAtlassianDataCenterProduct {    minimumVersion    maximumVersion    __typename  }}fragment ConnectAppScopes on MarketplaceConnectAppDeployment {  scopes {    id    capability    __typename  }  __typename}fragment EcosystemCloudAppDetails on MarketplaceCloudAppDeployment {  cloudAppId  scopes {    id    capability    __typename  }  __typename}"}`
        // ).toPromise();
        // console.log(response);
        this.app = await this.http.get(`/assets/app-data/${this.appId}.json`).toPromise();

        this.fullStars = Math.floor(this.app.data.marketplaceApp.reviewSummary.rating);
        this.halfStars = Math.ceil(this.app.data.marketplaceApp.reviewSummary.rating) - this.fullStars;

      }
    );
  }

}
